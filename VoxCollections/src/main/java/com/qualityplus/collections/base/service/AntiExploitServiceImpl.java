package com.qualityplus.collections.base.service;

import com.qualityplus.collections.VoxCollections;
import com.qualityplus.collections.api.service.AntiExploitService;
import com.qualityplus.assistant.lib.eu.okaeri.platform.core.annotation.Component;
import org.bukkit.entity.Player;
import org.bukkit.metadata.FixedMetadataValue;
import org.bukkit.metadata.Metadatable;

import java.util.HashMap;
import java.util.Map;
import java.util.UUID;

@Component
public final class AntiExploitServiceImpl implements AntiExploitService {
    private static final String METADATA_VALUE = "COLLECTION_ITEM_VALUE";
    private static final String METADATA_KEY = "COLLECTION_ITEM_KEY";
    private final Map<UUID, Long> timer = new HashMap<>();

    @Override
    public long getPlayerTimer(Player player) {
        return timer.getOrDefault(player.getUniqueId(), 0L);
    }

    @Override
    public void setPlayerTimer(Player player, long value) {
        timer.put(player.getUniqueId(), value);
    }

    @Override
    public void addMetadata(Metadatable metadatable) {
        metadatable.setMetadata(METADATA_KEY, new FixedMetadataValue(VoxCollections.getApi().getPlugin(), METADATA_VALUE));
    }

    @Override
    public boolean hasMetadata(Metadatable metadatable) {
        return metadatable.hasMetadata(METADATA_KEY);
    }
}
